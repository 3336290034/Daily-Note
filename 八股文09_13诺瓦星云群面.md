# 准备17号去诺瓦星云群面

## malloc和calloc和realloc的区别

- 这三个都是C语言中用于动态分配内存的核心函数
- malloc是简单的动态内存分配函数，它只分配内存，`不初始化内存`，内存中的值可能是随机的
- calloc是在malloc的基础上，额外添加了初始化内存的功能，会将内存中的值初始化为0
- realloc是在calloc的基础上，额外添加了重新分配内存的功能
  - 若扩大内存：新增部分的内存不初始化（值随机）
  - 若缩小内存：原内存数据会被保留，但超出新大小的部分会被截断（丢失）

- 速度最快的是malloc，较慢的是calloc，最后一个relloc和内存扩展方式有关

## 内存扩展方式有哪些？

## 二级指针是什么？二级指针和数组之间的关系是什么？

- 这个指针的值存着另一个指针的地址，仅此而已
- 和指针数组？
- 和数组指针？

- 涉及到“数组作为参数自动退化”的知识点

- 常见误区：二级指针不等于二维数组，二者在内存布局和类型特性上是不一样的

## C语言常说的静态存储区是什么？是不是用来存放static声明的变量的？

- 豆书记有话说：<https://www.doubao.com/thread/w2d30c57b9503ead5>；<https://www.doubao.com/chat/20302366689749762>
- 先解决静态存储区、动态存储区的问题
  - 静态存储区：内存分配与地址确定时机：在编译阶段就已经确定；编译器在编译程序时，会为静态存储区的内容（如全局变量、静态变量、字符串常量等）分配固定的内存空间，并确定其内存地址。这些地址在程序运行期间不会改变，直到程序结束才释放
  - 典型例子：全局变量（定义在函数外部的变量）、静态变量（用static修饰的局部或全局变量）、字符串常量（如"hello"这类字面量）

  - 动态存储区：内存分配与地址确定时机：在程序运行时动态确定；动态存储区的内存分配依赖于程序的执行逻辑（如函数调用、动态内存申请等），只有在运行到特定代码时才会分配内存，地址也是此时才确定的。使用完毕后会被释放（栈区自动释放，堆区需手动释放或由垃圾回收机制处理）
  - 典型例子：
    - 栈区：函数的局部变量、函数参数、返回值等（随函数调用创建，函数返回时释放）
    - 堆区：通过malloc（C）、new（C++）、malloc/free等动态申请的内存（需手动控制生命周期）

- 像这样的概念，可以衍生一些其他的问题，就像你说在你的项目里面使用static修饰数组buffer，这样可以存储前面的一些数据（传感器数据这些），内容不会被重置，后续什么的可以存储到Flash或者ROM里去

## 关于内存碎片的问题，这里再补充一些

- 在前面的动、静态存储区概念下：明白内存碎片不是在整个内存上存在的；内存碎片这玩意的核心场景是在动态存储区上；
  - 因为它的分配随着程序的执行随机发生变化，是不可预测的（你也不会想去了解它下一次的地址会在哪里
  - 而静态存储区上的东西在程序的编译时就确定，几乎不会产生内存碎片

- 内存碎片的两种核心类型
  - 外部碎片：多个不连续的 “小空闲块” 分散在已分配内存之间，单个空闲块太小无法满足新的大内存请求，但总空闲空间足够
    - 产生原因：动态存储区中 “频繁分配 / 释放不同大小的内存块”，导致空闲空间被切割成碎片
  - 内部碎片：分配给程序的内存块，实际使用的空间小于分配的空间，多余的 “内部空闲部分” 无法被其他请求利用：
    - 产生原因：内存分配算法的`对齐要求`（如为了效率，分配时必须按4字节 / 8字节对齐），或分配器按“固定块大小”分配（如不管需要1字节还是15字节，都分配16字节块）

- 动态存储区的碎片情况（核心场景）：Heap堆上，动态存储区主要就堆和栈，两者的碎片表现差异很大，其中堆是`外部碎片`的 `重灾区`，栈几乎无外部碎片，仅可能有少量内部碎片
  - 堆是程序员通过malloc/new主动申请、free/delete主动释放的区域，其 分配/释放 完全由程序运行逻辑决定，这种`随机分配 + 随机释放`的特性，必然会产生外部碎片
  - 此外，堆也可能存在内部碎片（比如分配器为了对齐，给 101B 的请求分配 104B，多余的 3B 就是内部碎片）

  - 栈是用于函数调用的`自动分配/释放区域`，对应你之前提到的`栈帧`，其分配释放遵循 `先进后出FILO`的严格规则
  - 函数调用时，压栈；函数返回时，弹栈；这种特性决定了栈，就会有外部碎片产生；少量内部碎片是栈帧中为了内存对齐，如结构体xxxx，但这部分碎片非常少，且随栈帧释放会自动消失，无需在意，衣角微脏~

## C语言里面的左值和右值是什么？

- 有助于理解数组名arr的下列使用：`a+1` 和 `&a+1` 有什么不同？
