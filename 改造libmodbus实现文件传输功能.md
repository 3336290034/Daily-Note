# Write File Record功能

1，设想场景如下：

上位机需要发文件给modbus传感器，可能发送1个或者多个文件....
那么，对于modbus传感器

- 需要知道是哪一个文件
- 文件可能很大，要知道发送的modbus数据包一次最多256字节，出去包头、校验码这些，能传输的数据更少
  - 由此，必然会将大文件拆分成若干个 块 来发送
  - 这里称为 Record，分解为多个Record来发送
  - 传输的数据包里面一定会包含这个文件里的哪一个 块？（Record）
- Record 的大小
- 数据本身

2，数据包的格式

- 设备地址
- 功能码：1个字节表示，0x15
- 数据长度：1个字节表示，范围0x09 ~ 0xFB   == （1+2+2+2 + 2N
  - 这个范围，小有讲究🤓
  - 数据长度  最大244字节，最小2字节

- 引用类型：1个字节表示，0x06（固定）
- File Number：2个字节表示，并不关心文件的名字，文件的number才是需要关心的 （编号），范围0x0001 ~ 0xFFFF
- Record Number：2个字节表示，我这大文件需要拆成多个小块来发送，这个意思就是指明了现在传输的是哪一个，范围0x0000 ~ 0x270F
- Record Length：2个字节表示数据长度大小 N

- Record Data：就是上一条说的 N个数据，每个数据大小 2个字节，总共 2N 个字节

- 校验码CRC：2个字节

3，上位机的回应：原样的数据，非常的简单粗暴啊😱😱😱

4，这个功能只是去发送文件的某一小块，并没有实现整个文件的传输的功能

- 那么问题来了，如果一个块只有一个字节怎么办？如何分辨？
- 如何实现写文件的功能？
  - 把一个文件拆分成诺干
