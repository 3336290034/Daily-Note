# 增加容错代码

## STM32H5主控

## Modbus传感器

1，等待超时时间太长
2，主设备请求发的太频繁
无法通过超时退出的机制重新启动
两个任务共用一个modbus总线：
若前一个数据有错误，就会进入超时等待，等待新的数据来组合成一个完整的数据发给主设备

- 前一个数据的错误可以是传感器发不出来，或者是上一个任务到现在还在占用Modbus数据总线发送数据
但是超时等待时间太长
前后两个任务发送数据的间隔太短，这样等不到前一个任务重新开启接收传感器数据
后一个任务的数据就被当作时当前任务需要的数据了，这样就会
导致两个任务的数据都出现错误，
这就是为什么我们看到按下按键迟迟没有反应的原因

上面说的是开关量模块和环境监测模块这两个任务

## 解决方案

1，调整任务获取数据的超时时间：即减少任务从传感器获得数据的超时等待时间

- 收到数据后，如果后续没有数据了，等待多久退出，这个值可以设置的小一点

2，调整任务间获取数据的间隔时间：即增加不同去使用Modbus数据总线获取数据的时间间隔

- 获得通道的使用权后（获得对应的二值信号量），等待20ms（vTaskDelay(20)），让传感器有足够的时间把数据发完
