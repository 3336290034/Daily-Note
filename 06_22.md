# Bootloader&&IAP&&OTA

1，为什么单片机需要bootloader？----> [Only_想要更新系统]

- Bootloader是基础，提供最底层的启动和更新能力；IAP是实现方式，允许程序自我更新；OTA是应用场景，通过网络远程触发IAP或Bootloader的更新流程；
- 先来看几个程序APP运行时的情况：
  - XIP(Execuye In Place)：不可取；
  - Flash上的程序(APP)copy到RAM上，在RAM上运行，再烧写到Flash上(覆盖原来的)，实现升级；[一旦失败，板子变砖]
  - 所以我们必须引入Bootloader

2，Bootloader架构：
    ┌───────────────────────────────────────────────────┐
    │                   Bootloader Code                 │
    ├───────────────────────────────────────────────────┤
    │ 硬件初始化（时钟、GPIO、看门狗）                     │
    ├───────────────────────────────────────────────────┤
    │ 检查更新标志位                                     │
    │ ├─ 无更新 → 跳转到App                              │
    │ └─ 有更新 → 执行更新流程                            │
    ├───────────────────────────────────────────────────┤
    │ 更新流程：                                          │
    │ 1. 从指定源（SD卡/网络）获取新固件                    │
    │ 2. 验证固件完整性（CRC/签名）                        │
    │ 3. 擦除目标Flash区域                                │
    │ 4. 写入新固件                                       │
    │ 5. 设置App有效标志                                  │
    │ 6. 跳转到新App                                     │
    └───────────────────────────────────────────────────┘

3，IAP(In Application Programming) && OTA更新固件程序

## 单片机的启动方式(STM32F4xx为例)

- MSP和PSP：主栈指针Main Stack Pointer 和 进程栈指针Process Stack Pointer
  - [text](https://www.doubao.com/thread/w77f9888f0d0168af)
- 复位产生后，单片机首先做的两件事：1.从向量表的0x00000000处读取SP的初始值__initial_sp(此时SP=MSP)；
                                  2.读取复位向量Reset_Handler的值，也就是PC计数器的值；
  - 启动电平的设置(Boot_0和Boot_1)会影响向量表的实际物理位置，“决定了逻辑地址 0x00000000 对应(映射到)哪个存储介质的起始地址”
- 设置堆和栈的大小
- 初始化中断向量表(硬件先 “利用” 现成的向量表启动，软件再 “完善” 向量表的运行时配置)
- 时钟初始化 SystemClockInit()，......
- 调用 C 库中的 _main 函数初始化用户堆栈，最终调用 main 函数

## LVGL

1，感觉这个东西也还是了解了一个之后，之后的就可以快速上手了，重点是要了解LVGL的开发流程和框架；[text](https://www.doubao.com/thread/w867b97dc25cb2571)

- 学习基础控件！！！[按钮、标签、滑块...]
  - 进一步就是组合成自定义控件
- 共性优先：掌握所有控件的通用操作：[对象的创建、调整大小/位置、设置样式、绑定事件]；
- 事件驱动机制：LVGL通过事件触发回调函数，要重点学习lv_obj_add_event_cb()和事件类型的使用；
- 显示和渲染：单/双/全尺寸缓冲区，
